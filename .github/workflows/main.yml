name: Browser-Based Kali (XFCE + noVNC)

on:
  workflow_dispatch:

jobs:
  kali-novnc:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: 🐳 Pull and Run Kali XFCE + noVNC Container
        run: |
          docker pull steinruck/kali-xfce-novnc
          docker run -d --name kali-gui \
            -p 6080:8080 -e VNC_PW=123456 steinruck/kali-xfce-novnc
          sleep 5

      - name: 🌍 Create public tunnel with localhost.run
        run: |
          nohup ssh -o StrictHostKeyChecking=no \
            -R 80:localhost:6080 nokey@localhost.run > tunnel.log 2>&1 &
          sleep 10
          echo "🔍 Tunnel Log:"
          cat tunnel.log || true
          echo "🌐 GUI might be available at:"
          grep -oE '[a-z0-9\-]{36}\.localhost\.run' tunnel.log | head -n1 || echo "❌ Tunnel not created"

      - name: 🕒 Keep Runner Alive
        run: sleep 3500
