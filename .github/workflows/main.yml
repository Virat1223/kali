name: Kali Linux Desktop over VNC (Serveo Tunnel)

on:
  workflow_dispatch:

jobs:
  kali:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Pull Kali Docker Image
        run: |
          docker pull kalilinux/kali-rolling

      - name: Start Kali Container
        run: |
          docker run -dit --name kali --privileged -p 5901:5901 kalilinux/kali-rolling bash

      - name: Install XFCE + VNC + SSH Client
        run: |
          docker exec kali apt update
          docker exec kali apt install -y xfce4 xfce4-goodies tightvncserver sudo dbus-x11
          sudo apt-get install -y openssh-client

      - name: Setup VNC Desktop
        run: |
          docker exec -e USER=root kali bash -c 'mkdir -p ~/.vnc && echo "123456" | vncpasswd -f > ~/.vnc/passwd && chmod 600 ~/.vnc/passwd'
          docker exec -e USER=root kali bash -c 'echo "#!/bin/bash" > ~/.vnc/xstartup && echo "startxfce4 &" >> ~/.vnc/xstartup && chmod +x ~/.vnc/xstartup'
          docker exec -e USER=root kali vncserver :1

      - name: Expose Port with Serveo (SSH)
        run: |
          ssh -o StrictHostKeyChecking=no -R 5901:localhost:5901 serveo.net &
          sleep 10
          echo "üõ∞Ô∏è  Serveo is exposing your VNC on port 5901."
          echo "‚û°Ô∏è  Connect your VNC viewer to: serveo.net:5901"
          echo "üîë Password: 123456"
          sleep 3500
